<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La B√†n Phong Th·ªßy - B√°ch Ng√¢n Construction</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0d0f13;
            color: #e5e7eb;
            min-height: 100vh
        }

        h1,
        h2,
        h3,
        .serif {
            font-family: 'Playfair Display', serif
        }

        .gold {
            color: #d4af37
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 16px
        }

        header {
            text-align: center;
            padding: 32px 0 24px
        }

        header h1 {
            font-size: 2.5rem;
            color: #d4af37;
            margin-bottom: 8px
        }

        header p {
            color: #9ca3af;
            font-size: 1rem;
            max-width: 600px;
            margin: 0 auto
        }

        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap
        }

        .tab-btn {
            padding: 10px 24px;
            border-radius: 999px;
            border: 1px solid #333;
            background: transparent;
            color: #9ca3af;
            cursor: pointer;
            font-size: .9rem;
            transition: .2s
        }

        .tab-btn.active {
            background: #d4af37;
            color: #000;
            border-color: #d4af37;
            font-weight: 600
        }

        .tab-btn:hover:not(.active) {
            border-color: #d4af37;
            color: #d4af37
        }

        .tab-panel {
            display: none
        }

        .tab-panel.active {
            display: block
        }

        /* Cards */
        .card {
            background: #16181d;
            border: 1px solid #222;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px
        }

        .card-title {
            font-size: 1.1rem;
            color: #d4af37;
            margin-bottom: 12px;
            font-weight: 600
        }

        .grid2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px
        }

        .info-box {
            background: #1e2028;
            padding: 14px;
            border-radius: 12px
        }

        .info-box .label {
            font-size: .75rem;
            color: #6b7280;
            margin-bottom: 4px
        }

        .info-box .value {
            font-size: 1.15rem;
            font-weight: 600
        }

        /* Compass */
        .compass-wrap {
            position: relative;
            width: 100%;
            max-width: 420px;
            aspect-ratio: 1;
            margin: 0 auto
        }

        .luopan {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, #c9a730, #b8942a 60%, #8b6914);
            position: relative;
            box-shadow: 0 0 40px rgba(212, 175, 55, .15), inset 0 0 30px rgba(0, 0, 0, .5);
            transition: transform .08s ease-out;
            border: 3px solid #705a10;
            cursor: grab
        }

        .luopan:active {
            cursor: grabbing
        }

        .center-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 14%;
            height: 14%;
            background: #111;
            border-radius: 50%;
            border: 2px solid #8b6508;
            z-index: 10
        }

        .needle {
            position: absolute;
            top: 12%;
            left: 50%;
            width: 2px;
            height: 76%;
            background: linear-gradient(#ef4444 50%, #d1d5db 50%);
            transform: translateX(-50%);
            z-index: 11
        }

        .cross-v,
        .cross-h {
            position: absolute;
            background: rgba(239, 68, 68, .5);
            z-index: 20;
            pointer-events: none
        }

        .cross-v {
            top: 0;
            left: 50%;
            width: 1px;
            height: 100%;
            transform: translateX(-50%)
        }

        .cross-h {
            top: 50%;
            left: 0;
            width: 100%;
            height: 1px;
            transform: translateY(-50%)
        }

        .deg-display {
            position: absolute;
            top: -28px;
            left: 50%;
            transform: translateX(-50%);
            color: #ef4444;
            font-weight: 700;
            font-size: 1rem;
            z-index: 21
        }

        .sector {
            position: absolute;
            top: 0;
            left: 50%;
            width: 2px;
            height: 50%;
            transform-origin: bottom center
        }

        .sector-line {
            position: absolute;
            width: 1px;
            height: 100%;
            left: 50%;
            background: rgba(0, 0, 0, .2)
        }

        .sector-label {
            position: absolute;
            top: 4px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            color: #1a1a1a
        }

        .ring {
            position: absolute;
            top: 50%;
            left: 50%;
            border-radius: 50%;
            border: 1px solid rgba(0, 0, 0, .25);
            transform: translate(-50%, -50%)
        }

        .ring-24 {
            width: 86%;
            height: 86%
        }

        .ring-8 {
            width: 58%;
            height: 58%
        }

        .r8-label {
            font-size: 14px;
            font-weight: 700;
            color: #7f1d1d;
            top: 6px
        }

        .el-water {
            color: #1e3a8a
        }

        .el-wood {
            color: #14532d
        }

        .el-fire {
            color: #7f1d1d
        }

        .el-earth {
            color: #713f12
        }

        .el-metal {
            color: #374151
        }

        /* Inputs */
        select,
        input[type=number] {
            background: #1e2028;
            border: 1px solid #333;
            color: #e5e7eb;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: .95rem;
            width: 100%;
            outline: none
        }

        select:focus,
        input:focus {
            border-color: #d4af37
        }

        label {
            display: block;
            font-size: .8rem;
            color: #9ca3af;
            margin-bottom: 6px
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: .9rem;
            font-weight: 600;
            transition: .2s
        }

        .btn-gold {
            background: #d4af37;
            color: #000
        }

        .btn-gold:hover {
            background: #c49b2f
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #d4af37;
            color: #d4af37
        }

        .btn-outline:hover {
            background: #d4af3720
        }

        /* L·ªó Ban Ruler */
        .ruler-bar {
            height: 32px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            margin: 8px 0
        }

        .ruler-segment {
            height: 100%;
            display: inline-block;
            line-height: 32px;
            text-align: center;
            font-size: .7rem;
            font-weight: 600;
            color: #fff
        }

        .ruler-good {
            background: #166534
        }

        .ruler-bad {
            background: #7f1d1d
        }

        .ruler-pointer {
            position: absolute;
            top: -6px;
            width: 2px;
            height: 44px;
            background: #d4af37;
            z-index: 2;
            transition: left .3s
        }

        .ruler-pointer::after {
            content: '‚ñº';
            position: absolute;
            top: -14px;
            left: -6px;
            color: #d4af37;
            font-size: 12px
        }

        .result-good {
            background: #052e16;
            border: 1px solid #166534;
            color: #4ade80;
            padding: 16px;
            border-radius: 12px
        }

        .result-bad {
            background: #2a0a0a;
            border: 1px solid #7f1d1d;
            color: #f87171;
            padding: 16px;
            border-radius: 12px
        }

        .result-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 4px
        }

        .result-desc {
            font-size: .85rem;
            opacity: .85
        }

        /* Layout helpers */
        .flex-col {
            display: flex;
            flex-direction: column;
            gap: 12px
        }

        .flex-row {
            display: flex;
            gap: 12px;
            align-items: end;
            flex-wrap: wrap
        }

        .flex-row>* {
            flex: 1;
            min-width: 120px
        }

        .mt16 {
            margin-top: 16px
        }

        .text-center {
            text-align: center
        }

        .text-sm {
            font-size: .85rem
        }

        .text-muted {
            color: #6b7280
        }

        @media(min-width:768px) {
            .layout-2col {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 24px;
                align-items: start
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üß≠ La B√†n Phong Th·ªßy</h1>
            <p>C√¥ng c·ª• tra c·ª©u h∆∞·ªõng nh√†, Cung M·ªánh gia ch·ªß & th∆∞·ªõc L·ªó Ban ‚Äî d√†nh ri√™ng cho kh√°ch h√†ng B√°ch Ng√¢n</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('compass', this)">üß≠ La Kinh</button>
            <button class="tab-btn" onclick="switchTab('kua', this)">üë§ Cung M·ªánh</button>
            <button class="tab-btn" onclick="switchTab('ruler', this)">üìè Th∆∞·ªõc L·ªó Ban</button>
        </div>

        <!-- TAB 1: LA KINH -->
        <div class="tab-panel active" id="tab-compass">
            <div class="layout-2col">
                <div class="text-center">
                    <div class="compass-wrap" id="compassWrap">
                        <div class="deg-display" id="degDisplay">0¬∞</div>
                        <div class="cross-v"></div>
                        <div class="cross-h"></div>
                        <div class="luopan" id="luopan">
                            <div class="center-dot">
                                <div class="needle"></div>
                            </div>
                            <div class="ring ring-8" id="ring8"></div>
                            <div class="ring ring-24" id="ring24"></div>
                        </div>
                    </div>
                    <p class="text-sm text-muted" style="margin-top:12px">K√©o chu·ªôt / c·∫£m ·ª©ng ƒë·ªÉ xoay la b√†n</p>
                    <button class="btn btn-outline" style="margin-top:8px" onclick="toggleDevice()">üì± B·∫≠t c·∫£m bi·∫øn
                        thi·∫øt b·ªã</button>
                </div>
                <div class="flex-col">
                    <div class="card">
                        <div class="card-title">H∆∞·ªõng hi·ªán t·∫°i: <span class="gold" id="cDir">Ch√≠nh B·∫Øc (0¬∞)</span></div>
                        <div class="grid2">
                            <div class="info-box">
                                <div class="label">S∆°n (24 S∆°n)</div>
                                <div class="value" id="cSon">T√Ω</div>
                            </div>
                            <div class="info-box">
                                <div class="label">Ng≈© H√†nh</div>
                                <div class="value" id="cElem">Th·ªßy</div>
                            </div>
                            <div class="info-box">
                                <div class="label">Qu√°i</div>
                                <div class="value" id="cGua">Kh·∫£m</div>
                            </div>
                            <div class="info-box">
                                <div class="label">Cung t·ªët</div>
                                <div class="value gold" id="cGood">ƒê√¥ng Nam</div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title">Lu·∫≠n gi·∫£i</div>
                        <p class="text-sm" id="cDesc" style="line-height:1.7;color:#d1d5db">H∆∞·ªõng Kh·∫£m (B·∫Øc) thu·ªôc Th·ªßy.
                            T∆∞·ª£ng tr∆∞ng cho tr√≠ tu·ªá, s·ª± kh·ªüi ƒë·∫ßu.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: CUNG M·ªÜNH -->
        <div class="tab-panel" id="tab-kua">
            <div class="layout-2col">
                <div class="card">
                    <div class="card-title">Nh·∫≠p th√¥ng tin gia ch·ªß</div>
                    <div class="flex-col">
                        <div><label>NƒÉm sinh (D∆∞∆°ng l·ªãch)</label><input type="number" id="birthYear" min="1930"
                                max="2030" value="1990" placeholder="VD: 1990"></div>
                        <div><label>Gi·ªõi t√≠nh</label>
                            <select id="gender">
                                <option value="male">Nam</option>
                                <option value="female">N·ªØ</option>
                            </select>
                        </div>
                        <button class="btn btn-gold" onclick="calcKua()">Xem Cung M·ªánh</button>
                    </div>
                </div>
                <div class="flex-col" id="kuaResult">
                    <div class="card">
                        <div class="card-title">K·∫øt qu·∫£</div>
                        <p class="text-muted text-sm">Nh·∫≠p nƒÉm sinh v√† nh·∫•n "Xem Cung M·ªánh" ƒë·ªÉ xem k·∫øt qu·∫£.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 3: TH∆Ø·ªöC L·ªñ BAN -->
        <div class="tab-panel" id="tab-ruler">
            <div class="layout-2col">
                <div class="card">
                    <div class="card-title">Nh·∫≠p k√≠ch th∆∞·ªõc</div>
                    <div class="flex-col">
                        <div class="flex-row">
                            <div><label>Lo·∫°i</label>
                                <select id="rulerType">
                                    <option value="door">C·ª≠a ch√≠nh</option>
                                    <option value="window">C·ª≠a s·ªï</option>
                                    <option value="bed">Gi∆∞·ªùng ng·ªß</option>
                                    <option value="desk">B√†n l√†m vi·ªác</option>
                                    <option value="other">Kh√°c</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex-row">
                            <div><label>Chi·ªÅu r·ªông (cm)</label><input type="number" id="sizeW" value="86" min="1"
                                    max="1000"></div>
                            <div><label>Chi·ªÅu cao (cm)</label><input type="number" id="sizeH" value="210" min="1"
                                    max="1000"></div>
                        </div>
                        <button class="btn btn-gold" onclick="calcRuler()">Tra Th∆∞·ªõc L·ªó Ban</button>
                    </div>
                </div>
                <div class="flex-col" id="rulerResult">
                    <div class="card">
                        <div class="card-title">K·∫øt qu·∫£</div>
                        <p class="text-muted text-sm">Nh·∫≠p k√≠ch th∆∞·ªõc v√† nh·∫•n "Tra Th∆∞·ªõc L·ªó Ban".</p>
                    </div>
                </div>
            </div>
        </div>

    </div><!-- container -->

    <script>
        /* ===== DATA ===== */
        const M24 = [
            { n: "T√Ω", d: 0, e: "Th·ªßy", c: "el-water", g: "Kh·∫£m" }, { n: "Qu√Ω", d: 15, e: "Th·ªßy", c: "el-water", g: "Kh·∫£m" },
            { n: "S·ª≠u", d: 30, e: "Th·ªï", c: "el-earth", g: "C·∫•n" }, { n: "C·∫•n", d: 45, e: "Th·ªï", c: "el-earth", g: "C·∫•n" },
            { n: "D·∫ßn", d: 60, e: "M·ªôc", c: "el-wood", g: "C·∫•n" }, { n: "Gi√°p", d: 75, e: "M·ªôc", c: "el-wood", g: "Ch·∫•n" },
            { n: "M√£o", d: 90, e: "M·ªôc", c: "el-wood", g: "Ch·∫•n" }, { n: "·∫§t", d: 105, e: "M·ªôc", c: "el-wood", g: "Ch·∫•n" },
            { n: "Th√¨n", d: 120, e: "Th·ªï", c: "el-earth", g: "T·ªën" }, { n: "T·ªën", d: 135, e: "M·ªôc", c: "el-wood", g: "T·ªën" },
            { n: "T·ªµ", d: 150, e: "H·ªèa", c: "el-fire", g: "T·ªën" }, { n: "B√≠nh", d: 165, e: "H·ªèa", c: "el-fire", g: "Ly" },
            { n: "Ng·ªç", d: 180, e: "H·ªèa", c: "el-fire", g: "Ly" }, { n: "ƒêinh", d: 195, e: "H·ªèa", c: "el-fire", g: "Ly" },
            { n: "M√πi", d: 210, e: "Th·ªï", c: "el-earth", g: "Kh√¥n" }, { n: "Kh√¥n", d: 225, e: "Th·ªï", c: "el-earth", g: "Kh√¥n" },
            { n: "Th√¢n", d: 240, e: "Kim", c: "el-metal", g: "Kh√¥n" }, { n: "Canh", d: 255, e: "Kim", c: "el-metal", g: "ƒêo√†i" },
            { n: "D·∫≠u", d: 270, e: "Kim", c: "el-metal", g: "ƒêo√†i" }, { n: "T√¢n", d: 285, e: "Kim", c: "el-metal", g: "ƒêo√†i" },
            { n: "Tu·∫•t", d: 300, e: "Th·ªï", c: "el-earth", g: "C√†n" }, { n: "C√†n", d: 315, e: "Kim", c: "el-metal", g: "C√†n" },
            { n: "H·ª£i", d: 330, e: "Th·ªßy", c: "el-water", g: "C√†n" }, { n: "Nh√¢m", d: 345, e: "Th·ªßy", c: "el-water", g: "Kh·∫£m" }
        ];
        const T8 = [
            { n: "Kh·∫£m", d: 0 }, { n: "C·∫•n", d: 45 }, { n: "Ch·∫•n", d: 90 }, { n: "T·ªën", d: 135 },
            { n: "Ly", d: 180 }, { n: "Kh√¥n", d: 225 }, { n: "ƒêo√†i", d: 270 }, { n: "C√†n", d: 315 }
        ];
        const guaDesc = {
            "Kh·∫£m": "H∆∞·ªõng Kh·∫£m (B·∫Øc) thu·ªôc Th·ªßy. T∆∞·ª£ng tr∆∞ng cho tr√≠ tu·ªá, s·ª± m·ªÅm m·ªèng nh∆∞ng s√¢u s·∫Øc. Ph√π h·ª£p m·ªánh ƒê√¥ng T·ª© Tr·∫°ch.",
            "C·∫•n": "H∆∞·ªõng C·∫•n (ƒê√¥ng B·∫Øc) thu·ªôc Th·ªï. T∆∞·ª£ng tr∆∞ng cho n√∫i, s·ª± tƒ©nh l·∫∑ng, t√≠ch l≈©y t√†i s·∫£n.",
            "Ch·∫•n": "H∆∞·ªõng Ch·∫•n (ƒê√¥ng) thu·ªôc M·ªôc. T∆∞·ª£ng tr∆∞ng cho s·∫•m, ph√°t tri·ªÉn m·∫°nh m·∫Ω, v∆∞∆°n l√™n.",
            "T·ªën": "H∆∞·ªõng T·ªën (ƒê√¥ng Nam) thu·ªôc M·ªôc. T∆∞·ª£ng tr∆∞ng cho gi√≥, s·ª± uy·ªÉn chuy·ªÉn, t√†i l·ªôc lan t·ªèa.",
            "Ly": "H∆∞·ªõng Ly (Nam) thu·ªôc H·ªèa. T∆∞·ª£ng tr∆∞ng cho √°nh s√°ng, danh v·ªçng, s·ª± r·ª±c r·ª°.",
            "Kh√¥n": "H∆∞·ªõng Kh√¥n (T√¢y Nam) thu·ªôc Th·ªï. T∆∞·ª£ng tr∆∞ng cho ƒë·∫•t, s·ª± bao dung nu√¥i d∆∞·ª°ng.",
            "ƒêo√†i": "H∆∞·ªõng ƒêo√†i (T√¢y) thu·ªôc Kim. T∆∞·ª£ng tr∆∞ng cho ƒë·∫ßm, vui v·∫ª, giao ti·∫øp t·ªët.",
            "C√†n": "H∆∞·ªõng C√†n (T√¢y B·∫Øc) thu·ªôc Kim. T∆∞·ª£ng tr∆∞ng cho tr·ªùi, quy·ªÅn l·ª±c, l√£nh ƒë·∫°o."
        };
        const guaGood = {
            "Kh·∫£m": "ƒê√¥ng Nam (Sinh Kh√≠)", "C·∫•n": "T√¢y Nam (Sinh Kh√≠)", "Ch·∫•n": "Nam (Sinh Kh√≠)", "T·ªën": "B·∫Øc (Sinh Kh√≠)",
            "Ly": "ƒê√¥ng (Sinh Kh√≠)", "Kh√¥n": "ƒê√¥ng B·∫Øc (Sinh Kh√≠)", "ƒêo√†i": "T√¢y B·∫Øc (Sinh Kh√≠)", "C√†n": "T√¢y (Sinh Kh√≠)"
        };
        const elemColor = { "Th·ªßy": "#3b82f6", "M·ªôc": "#22c55e", "H·ªèa": "#ef4444", "Th·ªï": "#eab308", "Kim": "#d1d5db" };

        /* ===== COMPASS ===== */
        const ring24 = document.getElementById('ring24'), ring8 = document.getElementById('ring8');
        M24.forEach(m => { const s = document.createElement('div'); s.className = 'sector'; s.style.transform = `rotate(${m.d}deg)`; s.innerHTML = `<div class="sector-line"></div><div class="sector-label ${m.c}">${m.n}</div>`; ring24.appendChild(s) });
        T8.forEach(t => { const s = document.createElement('div'); s.className = 'sector'; s.style.transform = `rotate(${t.d}deg)`; s.innerHTML = `<div class="sector-line" style="width:2px;background:rgba(0,0,0,.35)"></div><div class="sector-label r8-label">${t.n}</div>`; ring8.appendChild(s) });

        let rot = 0, dragging = false, sAngle = 0, sRot = 0;
        const lp = document.getElementById('luopan'), cw = document.getElementById('compassWrap');
        function ga(e) { const r = lp.getBoundingClientRect(), cx = r.left + r.width / 2, cy = r.top + r.height / 2, px = e.touches ? e.touches[0].clientX : e.clientX, py = e.touches ? e.touches[0].clientY : e.clientY; return Math.atan2(py - cy, px - cx) * 180 / Math.PI }
        function upd(d) {
            let nd = Math.round((360 - d % 360 + 360) % 360) % 360; document.getElementById('degDisplay').textContent = nd + '¬∞';
            let best = M24[0], bDiff = 360; M24.forEach(m => { let df = Math.abs(nd - m.d); if (df > 180) df = 360 - df; if (df < bDiff) { bDiff = df; best = m } });
            document.getElementById('cDir').textContent = `${best.g} (${nd}¬∞)`;
            document.getElementById('cSon').textContent = best.n;
            document.getElementById('cElem').textContent = best.e; document.getElementById('cElem').style.color = elemColor[best.e];
            document.getElementById('cGua').textContent = best.g;
            document.getElementById('cGood').textContent = guaGood[best.g];
            document.getElementById('cDesc').textContent = guaDesc[best.g]
        }
        cw.addEventListener('mousedown', e => { dragging = true; sAngle = ga(e); sRot = rot; lp.style.transition = 'none' });
        window.addEventListener('mousemove', e => { if (!dragging) return; rot = sRot + (ga(e) - sAngle); lp.style.transform = `rotate(${rot}deg)`; upd(rot) });
        window.addEventListener('mouseup', () => { if (dragging) { dragging = false; lp.style.transition = 'transform .08s ease-out' } });
        cw.addEventListener('touchstart', e => { e.preventDefault(); dragging = true; sAngle = ga(e); sRot = rot; lp.style.transition = 'none' }, { passive: false });
        window.addEventListener('touchmove', e => { if (!dragging) return; rot = sRot + (ga(e) - sAngle); lp.style.transform = `rotate(${rot}deg)`; upd(rot) }, { passive: false });
        window.addEventListener('touchend', () => { if (dragging) { dragging = false; lp.style.transition = 'transform .08s ease-out' } });

        let devOn = false;
        function toggleDevice() { if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') { DeviceOrientationEvent.requestPermission().then(p => { if (p === 'granted') doToggle(); else alert('C·∫ßn c·∫•p quy·ªÅn.') }).catch(() => doToggle()) } else doToggle() }
        function doToggle() { if (devOn) { window.removeEventListener('deviceorientation', onDev); devOn = false } else { window.addEventListener('deviceorientation', onDev); devOn = true } }
        function onDev(e) { let h = e.webkitCompassHeading || Math.abs(e.alpha - 360); if (h != null) { rot = -h; lp.style.transform = `rotate(${rot}deg)`; upd(rot) } }

        /* ===== TABS ===== */
        function switchTab(id, btn) { document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active')); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); document.getElementById('tab-' + id).classList.add('active'); btn.classList.add('active') }

        /* ===== KUA / CUNG M·ªÜNH ===== */
        const kuaInfo = {
            1: { name: "Kh·∫£m", elem: "Th·ªßy", group: "ƒê√¥ng T·ª© Tr·∫°ch", good: ["ƒê√¥ng Nam (Sinh Kh√≠)", "ƒê√¥ng (Thi√™n Y)", "Nam (Di√™n Ni√™n)", "B·∫Øc (Ph·ª•c V·ªã)"], bad: ["T√¢y B·∫Øc (H·ªça H·∫°i)", "T√¢y (L·ª•c S√°t)", "ƒê√¥ng B·∫Øc (Ng≈© Qu·ª∑)", "T√¢y Nam (Tuy·ªát M·ªánh)"] },
            2: { name: "Kh√¥n", elem: "Th·ªï", group: "T√¢y T·ª© Tr·∫°ch", good: ["ƒê√¥ng B·∫Øc (Sinh Kh√≠)", "T√¢y (Thi√™n Y)", "T√¢y B·∫Øc (Di√™n Ni√™n)", "T√¢y Nam (Ph·ª•c V·ªã)"], bad: ["ƒê√¥ng (H·ªça H·∫°i)", "ƒê√¥ng Nam (L·ª•c S√°t)", "Nam (Ng≈© Qu·ª∑)", "B·∫Øc (Tuy·ªát M·ªánh)"] },
            3: { name: "Ch·∫•n", elem: "M·ªôc", group: "ƒê√¥ng T·ª© Tr·∫°ch", good: ["Nam (Sinh Kh√≠)", "B·∫Øc (Thi√™n Y)", "ƒê√¥ng Nam (Di√™n Ni√™n)", "ƒê√¥ng (Ph·ª•c V·ªã)"], bad: ["T√¢y Nam (H·ªça H·∫°i)", "ƒê√¥ng B·∫Øc (L·ª•c S√°t)", "T√¢y B·∫Øc (Ng≈© Qu·ª∑)", "T√¢y (Tuy·ªát M·ªánh)"] },
            4: { name: "T·ªën", elem: "M·ªôc", group: "ƒê√¥ng T·ª© Tr·∫°ch", good: ["B·∫Øc (Sinh Kh√≠)", "Nam (Thi√™n Y)", "ƒê√¥ng (Di√™n Ni√™n)", "ƒê√¥ng Nam (Ph·ª•c V·ªã)"], bad: ["ƒê√¥ng B·∫Øc (H·ªça H·∫°i)", "T√¢y Nam (L·ª•c S√°t)", "T√¢y (Ng≈© Qu·ª∑)", "T√¢y B·∫Øc (Tuy·ªát M·ªánh)"] },
            6: { name: "C√†n", elem: "Kim", group: "T√¢y T·ª© Tr·∫°ch", good: ["T√¢y (Sinh Kh√≠)", "ƒê√¥ng B·∫Øc (Thi√™n Y)", "T√¢y Nam (Di√™n Ni√™n)", "T√¢y B·∫Øc (Ph·ª•c V·ªã)"], bad: ["ƒê√¥ng Nam (H·ªça H·∫°i)", "ƒê√¥ng (L·ª•c S√°t)", "B·∫Øc (Ng≈© Qu·ª∑)", "Nam (Tuy·ªát M·ªánh)"] },
            7: { name: "ƒêo√†i", elem: "Kim", group: "T√¢y T·ª© Tr·∫°ch", good: ["T√¢y B·∫Øc (Sinh Kh√≠)", "T√¢y Nam (Thi√™n Y)", "ƒê√¥ng B·∫Øc (Di√™n Ni√™n)", "T√¢y (Ph·ª•c V·ªã)"], bad: ["Nam (H·ªça H·∫°i)", "B·∫Øc (L·ª•c S√°t)", "ƒê√¥ng (Ng≈© Qu·ª∑)", "ƒê√¥ng Nam (Tuy·ªát M·ªánh)"] },
            8: { name: "C·∫•n", elem: "Th·ªï", group: "T√¢y T·ª© Tr·∫°ch", good: ["T√¢y Nam (Sinh Kh√≠)", "T√¢y B·∫Øc (Thi√™n Y)", "T√¢y (Di√™n Ni√™n)", "ƒê√¥ng B·∫Øc (Ph·ª•c V·ªã)"], bad: ["B·∫Øc (H·ªça H·∫°i)", "Nam (L·ª•c S√°t)", "ƒê√¥ng Nam (Ng≈© Qu·ª∑)", "ƒê√¥ng (Tuy·ªát M·ªánh)"] },
            9: { name: "Ly", elem: "H·ªèa", group: "ƒê√¥ng T·ª© Tr·∫°ch", good: ["ƒê√¥ng (Sinh Kh√≠)", "ƒê√¥ng Nam (Thi√™n Y)", "B·∫Øc (Di√™n Ni√™n)", "Nam (Ph·ª•c V·ªã)"], bad: ["T√¢y (H·ªça H·∫°i)", "T√¢y B·∫Øc (L·ª•c S√°t)", "T√¢y Nam (Ng≈© Qu·ª∑)", "ƒê√¥ng B·∫Øc (Tuy·ªát M·ªánh)"] }
        };

        function calcKua() {
            const yr = parseInt(document.getElementById('birthYear').value);
            const gen = document.getElementById('gender').value;
            if (isNaN(yr) || yr < 1930 || yr > 2030) { alert('NƒÉm sinh kh√¥ng h·ª£p l·ªá'); return }
            let s = 0, tmp = yr; while (tmp > 0) { s += tmp % 10; tmp = Math.floor(tmp / 10) }
            while (s > 9) { let t = 0; while (s > 0) { t += s % 10; s = Math.floor(s / 10) } s = t }
            let kua;
            if (gen === 'male') { kua = yr < 2000 ? (11 - s) : (9 - s); if (kua <= 0) kua += 9; if (kua === 5) kua = 2 }
            else { kua = yr < 2000 ? (s + 4) : (s + 6); while (kua > 9) kua -= 9; if (kua === 5) kua = 8 }
            const k = kuaInfo[kua]; if (!k) { alert('L·ªói t√≠nh to√°n'); return }
            const ec = elemColor[k.elem] || '#d4af37';
            let html = `<div class="card"><div class="card-title">Cung M·ªánh: <span style="color:${ec}">${k.name} (S·ªë ${kua})</span></div>
  <div class="grid2">
    <div class="info-box"><div class="label">Ng≈© H√†nh</div><div class="value" style="color:${ec}">${k.elem}</div></div>
    <div class="info-box"><div class="label">Nh√≥m</div><div class="value gold">${k.group}</div></div>
    <div class="info-box"><div class="label">NƒÉm sinh</div><div class="value">${yr}</div></div>
    <div class="info-box"><div class="label">Gi·ªõi t√≠nh</div><div class="value">${gen === 'male' ? 'Nam' : 'N·ªØ'}</div></div>
  </div></div>
  <div class="card"><div class="card-title" style="color:#4ade80">‚úÖ 4 H∆∞·ªõng T·ªët</div>`;
            k.good.forEach(g => html += `<div class="info-box" style="margin-bottom:6px;border-left:3px solid #166534"><div class="value" style="font-size:.95rem;color:#4ade80">${g}</div></div>`);
            html += `</div><div class="card"><div class="card-title" style="color:#f87171">‚õî 4 H∆∞·ªõng X·∫•u</div>`;
            k.bad.forEach(b => html += `<div class="info-box" style="margin-bottom:6px;border-left:3px solid #7f1d1d"><div class="value" style="font-size:.95rem;color:#f87171">${b}</div></div>`);
            html += `</div>`;
            document.getElementById('kuaResult').innerHTML = html;
        }

        /* ===== L·ªñ BAN RULER ===== */
        const LB = [
            { name: "T√†i", good: true, sub: ["T√†i ƒê·ª©c", "B·∫£o Kh·ªë", "L·ª•c H·ª£p", "Nghinh Ph√∫c"] },
            { name: "B·ªánh", good: false, sub: ["Tho√°i T√†i", "C√¥ng S·ª±", "Lao Ch·∫•p", "C√¥ Qu·∫£"] },
            { name: "Ly", good: false, sub: ["Tr∆∞·ªüng Kh·ªë", "Ki·∫øp T√†i", "Quan Qu·ª∑", "Th·∫•t Tho√°t"] },
            { name: "Nghƒ©a", good: true, sub: ["Thi√™m ƒêinh", "√çch L·ª£i", "Qu√Ω T·ª≠", "ƒê·∫°i C√°t"] },
            { name: "Quan", good: true, sub: ["Thu·∫≠n Khoa", "Ho·∫°ch T√†i", "T·∫•n √çch", "Ph√∫ Qu√Ω"] },
            { name: "Ki·∫øp", good: false, sub: ["T·ª≠ Bi·ªát", "Tho√°i Kh·∫©u", "Ly H∆∞∆°ng", "T√†i Th·∫•t"] },
            { name: "H·∫°i", good: false, sub: ["Tai Ch√≠", "T·ª≠ Tuy·ªát", "B·ªánh L√¢m", "Kh·∫©u Thi·ªát"] },
            { name: "B·∫£n", good: true, sub: ["T√†i Ch√≠", "ƒêƒÉng Khoa", "T·∫•n B·∫£o", "H∆∞ng V∆∞·ª£ng"] }
        ];
        const CYCLE = 43.2; // cm per cycle

        function getLB(cm) {
            const pos = ((cm % CYCLE) + CYCLE) % CYCLE;
            const segSize = CYCLE / 8;
            const idx = Math.floor(pos / segSize);
            const subSize = segSize / 4;
            const subIdx = Math.floor((pos % segSize) / subSize);
            return { ...LB[idx], subName: LB[idx].sub[subIdx], pos, segSize, idx }
        }

        function calcRuler() {
            const w = parseFloat(document.getElementById('sizeW').value);
            const h = parseFloat(document.getElementById('sizeH').value);
            if (isNaN(w) || isNaN(h) || w <= 0 || h <= 0) { alert('K√≠ch th∆∞·ªõc kh√¥ng h·ª£p l·ªá'); return }
            const rw = getLB(w), rh = getLB(h);
            const typ = document.getElementById('rulerType');
            const typeName = typ.options[typ.selectedIndex].text;

            function renderOne(label, cm, r) {
                const cls = r.good ? 'result-good' : 'result-bad';
                const icon = r.good ? '‚úÖ' : '‚ö†Ô∏è';
                // ruler bar
                const pct = ((r.pos / CYCLE) * 100).toFixed(1);
                let bar = '<div class="ruler-bar" style="display:flex">';
                LB.forEach(l => { bar += `<div class="ruler-segment ${l.good ? 'ruler-good' : 'ruler-bad'}" style="width:12.5%">${l.name}</div>` });
                bar += `<div class="ruler-pointer" style="left:${pct}%"></div></div>`;
                return `<div class="card"><div class="card-title">${label}: ${cm} cm</div>${bar}
    <div class="${cls}" style="margin-top:12px"><div class="result-title">${icon} ${r.name} ‚Äî ${r.subName}</div>
    <div class="result-desc">${r.good ? 'K√≠ch th∆∞·ªõc n√†y n·∫±m trong cung T·ªêT theo th∆∞·ªõc L·ªó Ban. Ph√π h·ª£p s·ª≠ d·ª•ng.' : 'K√≠ch th∆∞·ªõc n√†y n·∫±m trong cung X·∫§U theo th∆∞·ªõc L·ªó Ban. N√™n ƒëi·ªÅu ch·ªânh th√™m/b·ªõt v√†i cm.'}</div></div></div>`
            }

            let suggest = '';
            if (!rw.good || !rh.good) {
                suggest = '<div class="card"><div class="card-title">üí° G·ª£i √Ω k√≠ch th∆∞·ªõc t·ªët l√¢n c·∫≠n</div><div class="text-sm" style="color:#d1d5db;line-height:1.8">';
                if (!rw.good) {
                    let sw = findGood(w);
                    suggest += `<p>‚Ä¢ Chi·ªÅu r·ªông: th·ª≠ <strong class="gold">${sw.join(' cm</strong> ho·∫∑c <strong class="gold">')} cm</strong></p>`;
                }
                if (!rh.good) {
                    let sh = findGood(h);
                    suggest += `<p>‚Ä¢ Chi·ªÅu cao: th·ª≠ <strong class="gold">${sh.join(' cm</strong> ho·∫∑c <strong class="gold">')} cm</strong></p>`;
                }
                suggest += '</div></div>';
            }

            document.getElementById('rulerResult').innerHTML =
                `<div class="card" style="background:#111;border-color:#d4af37"><div class="card-title">K·∫øt qu·∫£ tra ${typeName}</div>
    <p class="text-sm text-muted">${typeName} k√≠ch th∆∞·ªõc ${w} √ó ${h} cm</p></div>`
                + renderOne('Chi·ªÅu r·ªông', w, rw) + renderOne('Chi·ªÅu cao', h, rh) + suggest;
        }

        function findGood(cm) {
            const results = [];
            for (let delta = 1; delta <= 15; delta++) {
                [cm - delta, cm + delta].forEach(v => {
                    if (v > 0 && getLB(v).good && results.length < 4) results.push(Math.round(v * 10) / 10);
                });
                if (results.length >= 4) break;
            }
            return results.slice(0, 4);
        }

        upd(0);
    </script>
</body>

</html>